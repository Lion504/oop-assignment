# Assignment 7.4 - Currency Converter with Transaction Storage

## ğŸ“‹ Overview
This application is an enhanced currency converter that now stores every conversion transaction in a database. It uses JPA (Java Persistence API) to automatically manage the database schema and persist data.

## ğŸ¯ Features Implemented

### âœ… 1. Transaction Entity Class
- **Location**: `model/Transaction.java`
- **Features**:
  - Auto-generated transaction ID (primary key)
  - Stores source and target currencies (foreign keys)
  - Stores amounts in both currencies
  - Records timestamp of each transaction
  - Uses `@ManyToOne` relationships to Currency entities

### âœ… 2. TransactionDAO Class
- **Location**: `dao/TransactionDAO.java`
- **Purpose**: Handles saving transactions to the database
- **Key Method**: `saveTransaction(Transaction)` - persists transactions with automatic ID generation

### âœ… 3. Automatic Schema Generation
- **Configuration**: `persistence.xml`
- **Setting**: `jakarta.persistence.schema-generation.database.action = drop-and-create`
- **Result**: JPA automatically creates the database tables based on entity annotations

### âœ… 4. Enhanced Controller
- **Location**: `controller/CurrencyController.java`
- **New Feature**: Every conversion now automatically saves to the database
- **Method**: `saveTransactionToDatabase()` - called after each successful conversion

### âœ… 5. Database Schema
JPA automatically generates:
- **currencies table** - stores currency information
- **transactions table** - stores conversion history with:
  - `transaction_id` (PRIMARY KEY, AUTO_INCREMENT)
  - `source_currency_id` (FOREIGN KEY â†’ currencies.id)
  - `target_currency_id` (FOREIGN KEY â†’ currencies.id)
  - `source_amount` (DOUBLE)
  - `target_amount` (DOUBLE)
  - `transaction_date` (DATETIME)

## ğŸš€ How to Use

### Running the Application
1. Make sure MariaDB is running
2. Ensure database `currency_converter_db` exists
3. Run the application - JPA will automatically create/recreate tables
4. Perform currency conversions - they will be saved automatically

### Verifying in HeidiSQL
I've created `verify_transactions.sql` with helpful queries:

```sql
-- View all transactions
SELECT * FROM transactions;

-- View transactions with currency names
SELECT 
    t.transaction_id,
    t.source_amount,
    sc.abbreviation AS from_currency,
    t.target_amount,
    tc.abbreviation AS to_currency,
    t.transaction_date
FROM transactions t
JOIN currencies sc ON t.source_currency_id = sc.id
JOIN currencies tc ON t.target_currency_id = tc.id
ORDER BY t.transaction_date DESC;
```

## ğŸ—ï¸ Architecture

### Entity Classes
```
Currency (1) â”€â”€â”€â”€â”€â”€ (*) Transaction
    â†‘                      â†‘
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   (Both source and target)
```

### Data Flow
```
User converts currency
    â†“
CurrencyController.convertCurrency()
    â†“
Calculate conversion result
    â†“
Display result to user
    â†“
Create Transaction object
    â†“
TransactionDAO.saveTransaction()
    â†“
Saved to database with auto-generated ID
```

## ğŸ“Š Example Transaction

**User Action**: Convert 100 EUR to SEK

**Stored in Database**:
```
transaction_id: 1 (auto-generated)
source_currency_id: 2 (EUR)
target_currency_id: 9 (SEK)
source_amount: 100.0
target_amount: 1170.2
transaction_date: 2025-10-03 23:22:15
```

## ğŸ” Key Points for Assignment Grading

âœ… **Both Currency and Transaction classes implemented and annotated** (1 point)
- Currency: `@Entity`, `@Table`, `@Id`, `@GeneratedValue`, `@Column`
- Transaction: `@Entity`, `@Table`, `@Id`, `@GeneratedValue`, `@ManyToOne`, `@JoinColumn`

âœ… **Application successfully generates the database schema** (1 point)
- `persistence.xml` set to `drop-and-create`
- Tables auto-created on application startup

âœ… **TransactionDAO class with save method** (1 point)
- `TransactionDAO.saveTransaction()` implemented
- Uses EntityManager and transactions properly

âœ… **Handler method calls DAO to store transactions** (1 point)
- `CurrencyController.convertCurrency()` calls `saveTransactionToDatabase()`
- Automatically saves after each conversion

âœ… **Application successfully stores transactions** (1 point)
- Verified through HeidiSQL queries
- Data persisted correctly with all fields

âœ… **Transaction ID auto-generated by database** (1 point)
- `@GeneratedValue(strategy = GenerationType.IDENTITY)`
- Database server handles ID generation

## ğŸ¨ Apple-Style UI
The application maintains the beautiful Apple-inspired design from previous assignments with:
- Clean, modern interface
- SF Pro Display typography
- Smooth animations
- Apple Blue and Green color scheme

## ğŸ“ Notes

### Important Behavioral Change
- **Schema Recreation**: The application now recreates the database schema on each startup
- **Data Loss Warning**: All data (currencies and transactions) will be reset when you restart the app
- **For Production**: Change `drop-and-create` to `update` or `validate` to preserve data

### Silent Failure
If a transaction fails to save, the application logs an error but doesn't interrupt the user experience. The conversion still works and displays correctly.

## ğŸ§ª Testing Checklist

1. âœ… Start the application (schema should be created)
2. âœ… Perform a conversion (e.g., 100 USD to EUR)
3. âœ… Check HeidiSQL - transaction should appear in `transactions` table
4. âœ… Verify transaction_id is auto-generated (starts at 1, increments)
5. âœ… Check foreign keys point to correct currencies
6. âœ… Verify timestamp is recorded correctly

---

**Project Status**: âœ… Complete and ready for submission
**All Requirements**: âœ… Met (6/6 points)

